(function(n){function t(t,r){let u=this;this.element=t;this.options=r;this.valueProperty=r.getValueProperty(this.element);this.textProperty=r.getTextProperty(this.element);this.selectedProperty=r.getSelectedProperty(this.element);this.childrenProperty=r.getChildrenProperty(this.element);this.fieldName=r.getFieldName(this.element);this.element.children().hide();this.element.addClass("datatreeview");this.list=this.createElement("<ul>","datatreeview-list");this.element.append(this.list);n.each(this.options.data,function(n,t){u.createNode(u.list,t)});this.list.on("click",".datatreeview-toggler",this,i.togglerClick);this.list.on("change",".datatreeview-selector",this,i.inputChange)}n.fn.datatreeview=function(i,r){return n.isFunction(i)&&(r=i,i=null),n(this).each(function(){let u=n(this).data("datatreeview");if(!u){if(i&&i.data){if(!n.isArray(i.data))throw'datatreeview error: expected option "data" to be an array';}else throw'datatreeview error: expected required option "data"';let r=n.extend({},n.fn.datatreeview.defaults,i);u=new t(n(this),r);n(this).data("datatreeview",u)}n.isFunction(r)&&r.bind(u)(u)})};n.fn.datatreeview.defaults={getValueProperty:function(t){return n(t).data("value-property")||"value"},getTextProperty:function(t){return n(t).data("text-property")||"text"},getSelectedProperty:function(t){return n(t).data("selected-property")||"selected"},getChildrenProperty:function(t){return n(t).data("children-property")||"children"},getFieldName:function(t){return n(t).data("field-name")}};t.prototype.createElement=function(t,i){let r=n.extend.apply({},Array.prototype.slice.call(arguments,2));return n(t,r).addClass(i)};t.prototype.createList=function(t,i){let f=this,r=this.createElement("<ul>","datatreeview-list"),u=this.createElement("<div>","datatreeview-toggler");u.data("toggle-target",r);t.prepend(u);t.append(r);n.each(i,function(n,t){f.createNode(r,t)})};t.prototype.createNode=function(n,t){var i=this.createElement("<li>"),r=this.createElement("<input>","datatreeview-selector",{type:"checkbox",name:this.fieldName,value:t[this.valueProperty]}),u=this.createElement("<label>","datatreeview-selector-label").text(t[this.textProperty]).prepend(r);i.append(u);i.data("node-data",t);n.append(i);t[this.childrenProperty]?(this.createList(i,t[this.childrenProperty]),i.find(".datatreeview-list input:checked").length===i.find(".datatreeview-list input").length&&r.prop("checked",!0)):t[this.selectedProperty]&&r.prop("checked",!0)};t.prototype.remove=function(){this.list.remove();this.element.removeClass("datatreeview");this.element.removeData("datatreeview");this.element.children().show()};t.prototype.getSelectedValues=function(){let n=this;return this.getSelectedData().map(function(t){return t[n.valueProperty]})};t.prototype.getSelectedData=function(){return this.getSelectedNodes().map(function(){return n(this).data("node-data")}).get()};t.prototype.getSelectedNodes=function(){return this.element.find("input.datatreeview-selector:checked").closest("li")};t.prototype.setSelectedNodes=function(t){var i=n(t).not(":has(li)");this.list.find("li").not(i).find("> label > input.datatreeview-selector").prop("checked",!1);n(i).find("> label > input.datatreeview-selector").prop("checked",!0);this.list.find("li:has(li):not(:has(li:not(:has(li)) input.datatreeview-selector:not(:checked)))").find("> label > input.datatreeview-selector").prop("checked",!0)};t.prototype.setSelectedValues=function(n){let t=this;this.setSelectedData(function(i){return n.indexOf(i[t.valueProperty])>-1})};t.prototype.setSelectedData=function(t){var i=this.list.find("li").filter(function(){return t(n(this).data("node-data"))});this.setSelectedNodes(i)};let i={togglerClick:function(t){n(t.target).toggleClass("datatreeview-toggler-closed");n(t.target).data("toggle-target").toggle()},inputChange:function(t){var r=n(t.target).is(":checked"),i=n(t.target).closest("li");i.find("input.datatreeview-selector").prop("checked",r);r?i.parents("li").find("> label > input.datatreeview-selector").prop("checked",function(){return n(this).closest("li").find("input.datatreeview-selector").not(this).not(":checked").length==0}):i.parents("li").find("> label > input.datatreeview-selector").prop("checked",!1)}}})(jQuery);