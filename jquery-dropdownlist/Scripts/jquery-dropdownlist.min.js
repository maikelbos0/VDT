(function(n){function i(t,i){let u=this,f=!1;this.element=t;this.options=i;this.fieldName=this.options.getFieldName(this.element)||"dropdownlist-"+Math.random().toString().replace(".","");this.isDisabled=!1;this.isMultiselect=this.options.isMultiselect(this.element);this.selectAllItem=this.isMultiselect?this.options.getSelectAllItem(this.element):n();this.allItems=this.options.getItems(this.element).add(this.selectAllItem);this.items=this.options.getItems(this.element).not(this.selectAllItem);this.textSearch=n();this.isTextSearchInsideSelector=!1;this.hasDynamicPositioning=this.options.hasDynamicPositioning(this.element);this.emptyText=this.options.getEmptyText(this.element);this.container=this.createElement("<div>","dropdownlist",this.options.getContainerAttributes());this.element.before(this.container);this.selector=this.createElement("<div>","dropdownlist-selector",this.options.getSelectorAttributes(),{tabindex:0});this.selectorText=this.createElement("<div>","dropdownlist-selector-text",this.options.getSelectorTextAttributes());this.selector.append(this.selectorText,this.createElement("<div>","dropdownlist-selector-toggle",this.options.getSelectorToggleAttributes()));this.list=this.createElement("<div>","dropdownlist-list",this.options.getListAttributes()).append(this.element).hide();this.options.hasTextSearch(this.element)&&(this.textSearch=this.createElement("<input>","dropdownlist-search",this.options.getTextSearchAttributes(),{type:"text"}),this.isTextSearchInsideSelector=this.options.isTextSearchInsideSelector(this.element),this.isTextSearchInsideSelector?(this.selector.prepend(this.textSearch),this.textSearch.hide()):this.list.prepend(this.textSearch));this.items.prepend(this.createElement("<input>","dropdownlist-field",this.options.getInputAttributes(),{name:this.fieldName,value:u.options.getItemValue(n(this)),tabindex:-1,type:u.isMultiselect?"checkbox":"radio"}));this.items.each(function(){let t=n(this).find("input.dropdownlist-field");t.val(u.options.getItemValue(n(this)));u.options.isItemSelected(n(this))&&(u.isMultiselect||!f)&&(t.prop("checked","true"),f=!0)});this.isMultiselect||this.getSelectedItems().length!==0||this.setSelectedItems(":first");this.isMultiselect&&this.selectAllItem.length>0&&this.selectAllItem.prepend(this.createElement("<input>","dropdownlist-field",this.options.getInputAttributes(),{type:"checkbox",checked:this.areAllItemsSelected(),tabindex:-1}));this.container.append(this.selector);this.container.append(this.list);this.setSelectorText();this.options.isDisabled(this.element)&&this.disable();this.container.focusout(this,r.containerFocusout);this.container.keydown(this,r.containerKeydown);this.selector.click(this,r.selectorClick);this.list.click(this,r.listClick);this.element.on("change","input.dropdownlist-field",this,r.inputChange);this.textSearch.keydown(this,r.textSearchKeydown);this.textSearch.keyup(this,r.textSearchKeyup);n(document).click(this,r.documentClick);this.element.on("mouseover","*",this,r.allItemsMouseover);this.element.on("mouseout","*",this,r.allItemsMouseout)}n.fn.dropdownlist=function(t,r){return n.isFunction(t)&&(r=t,t=null),n(this).each(function(){let u=n(this).data("dropdownlist");if(!u){let r=n.extend({},n.fn.dropdownlist.defaults,t);u=new i(n(this),r);n(this).data("dropdownlist",u)}n.isFunction(r)&&r.bind(u)(u)})};n.fn.dropdownlist.defaults={getItems:function(t){return n(t).children()},getSelectAllItem:function(t){return n(t).children().filter("[data-select-all]").first()},isItemSelected:function(t){return n(t).data("selected")!==undefined&&n(t).data("selected")!=!1},getFieldName:function(t){return n(t).data("field-name")},isDisabled:function(t){return n(t).data("disabled")!==undefined&&n(t).data("disabled")!=!1},getItemValue:function(t){return n(t).data("value")||n(t).text()},getItemText:function(t){return n(t).text()},getEmptyText:function(t){return n(t).data("empty-text")||"(Select...)"},isMultiselect:function(t){return n(t).data("multiselect")!==undefined&&n(t).data("multiselect")!=!1},hasTextSearch:function(t){return n(t).data("text-search")!==undefined&&n(t).data("text-search")!=!1},isTextSearchInsideSelector:function(t){return n(t).data("selector-text-search")!==undefined&&n(t).data("selector-text-search")!=!1},itemMatchesTextSearch:function(t,i){return n(t).text().toLocaleLowerCase().indexOf(i.toLocaleLowerCase())>-1},hasDynamicPositioning:function(t){return n(t).data("dynamic-positioning")!==undefined&&n(t).data("dynamic-positioning")!=!1},getContainerAttributes:function(){return{}},getSelectorAttributes:function(){return{}},getSelectorTextAttributes:function(){return{}},getSelectorToggleAttributes:function(){return{}},getListAttributes:function(){return{}},getTextSearchAttributes:function(){return{}},getInputAttributes:function(){return{}}};i.prototype.createElement=function(t,i){let r=n.extend.apply({},Array.prototype.slice.call(arguments,2));return n(t,r).addClass(i)};i.prototype.isVisible=function(){return this.list.css("display")!=="none"};i.prototype.toggle=function(){this.isVisible()?this.hide():this.show()};i.prototype.hide=function(){this.isVisible()&&(this.list.hide(),this.allItems.removeClass("dropdownlist-list-item-active"),this.hasDynamicPositioning&&(this.list.css("max-height",""),this.list.css("bottom",""),this.list.removeClass("dropdownlist-list-up")),this.textSearch.length>0&&(this.textSearch.filter(document.activeElement).length>0&&this.selector.focus(),this.isTextSearchInsideSelector?(this.selectorText.show(),this.textSearch.hide(),this.textSearch.val(this.selectorText.text())):this.textSearch.val(""),this.items.show()),this.element.trigger("dropdownlist.hidden"))};i.prototype.show=function(){if(!this.isDisabled){if(this.hasDynamicPositioning){let i=n(document).height()-this.selector.offset().top-this.selector.outerHeight(),t=this.list.outerHeight();if(t>i){let n=this.selector.offset().top;t>n?this.list.css("max-height",i-(t-this.list.height())+"px"):(this.list.addClass("dropdownlist-list-up"),this.list.css("bottom",this.selector.outerHeight()+"px"))}}this.list.show();this.textSearch.length>0&&(this.isTextSearchInsideSelector&&(this.selectorText.hide(),this.textSearch.show().select()),this.textSearch.focus());this.isMultiselect||(this.items.has("input.dropdownlist-field:checked").addClass("dropdownlist-list-item-active"),this.scrollToActiveItem());this.element.trigger("dropdownlist.shown")}};i.prototype.scrollToActiveItem=function(){let n=this.items.filter(".dropdownlist-list-item-active");n.length>0&&n[0].scrollIntoView&&(n.position().top<0?this.list.scrollTop(this.list.scrollTop()+n.position().top):n.position().top+n.outerHeight(!0)>this.list.height()&&this.list.scrollTop(this.list.scrollTop()-this.list.height()+n.position().top+n.outerHeight(!0)))};i.prototype.remove=function(){this.container.before(this.element);this.container.remove();this.items.find("input.dropdownlist-field").remove();this.items.removeClass("dropdownlist-list-item-active");this.selectAllItem.find("input.dropdownlist-field").remove();this.selectAllItem.removeClass("dropdownlist-list-item-active");this.element.off("change","input.dropdownlist-field",r.inputChange);this.element.off("mouseover","*",r.allItemsMouseover);this.element.off("mouseout","*",r.allItemsMouseout);this.element.removeData("dropdownlist")};i.prototype.setSelectorText=function(){let i=this.getSelectedItems(),t=this.emptyText;i.length>0&&(t=n.map(i,this.options.getItemText).join(", "));this.selectorText.text(t);this.isTextSearchInsideSelector&&this.textSearch.length>0&&this.textSearch.val(t)};i.prototype.getSelectedItems=function(){return this.items.has("input.dropdownlist-field:checked")};i.prototype.getSelectedValues=function(){return n.map(this.getSelectedItems(),this.options.getItemValue)};i.prototype.setSelectedItems=function(n){let t=this.items.filter(n);this.options.isMultiselect(this.element)||(t=t.first(),t.length===0&&(t=this.items.first()));this.items.not(t).find("input.dropdownlist-field:checked").prop("checked",!1);t.find("input.dropdownlist-field:not(:checked)").prop("checked",!0);this.setSelectorText()};i.prototype.selectAllItems=function(){this.setSelectedItems("*")};i.prototype.clearSelectedItems=function(){this.setSelectedItems(!1)};i.prototype.areAllItemsSelected=function(){return this.items.has("input.dropdownlist-field:not(:checked)").length===0};i.prototype.enable=function(){this.isDisabled&&(this.isDisabled=!1,this.allItems.find("input.dropdownlist-field").prop("disabled",this.isDisabled),this.container.removeClass("dropdownlist-disabled"),this.selector.prop("tabindex",0))};i.prototype.disable=function(){this.isDisabled||(this.isDisabled=!0,this.allItems.find("input.dropdownlist-field").prop("disabled",this.isDisabled),this.container.addClass("dropdownlist-disabled"),this.selector.prop("tabindex",-1))};let r={selectorClick:function(t){n(t.target).is(t.data.textSearch)||t.data.toggle()},inputChange:function(t){t.data.isMultiselect&&t.data.selectAllItem.length>0&&(n(t.target).closest(t.data.selectAllItem).length>0?t.data.selectAllItem.find("input.dropdownlist-field").prop("checked")?t.data.selectAllItems():t.data.clearSelectedItems():t.data.selectAllItem.find("input.dropdownlist-field").prop("checked",t.data.areAllItemsSelected()));t.data.setSelectorText();t.data.element.trigger("dropdownlist.selectedItemsChanged",[t.data.getSelectedItems(),t.data.getSelectedValues()])},listClick:function(t){let i=n(t.target).closest(t.data.allItems);if(i.length!==0){let r=i.find("input.dropdownlist-field");r.is(t.target)?t.data.isMultiselect||t.data.hide():r.click()}},textSearchKeyup:function(n){if(n.which!==t.ENTER&&n.which!==t.ESCAPE&&n.which!==t.ARROW_UP&&n.which!==t.ARROW_DOWN){let r=n.data.textSearch.val(),i=n.data.items;r&&(i=i.filter(function(){return n.data.options.itemMatchesTextSearch(this,r)}));n.data.items.not(i).hide();i.show()}},documentClick:function(t){n(t.target).closest(t.data.container).length>0||t.data.hide()},allItemsMouseover:function(t){t.data.allItems.filter(this).length!==0&&(t.data.allItems.not(this).removeClass("dropdownlist-list-item-active"),n(this).addClass("dropdownlist-list-item-active"))},allItemsMouseout:function(n){n.data.allItems.filter(this).length!==0&&n.data.allItems.removeClass("dropdownlist-list-item-active")},containerFocusout:function(t){t.relatedTarget==null?n(t.target).focus():n(t.relatedTarget).closest(t.data.container).length===0&&t.data.hide()},textSearchKeydown:function(n){n.which===t.SPACE&&n.stopPropagation()},containerKeydown:function(i){if(i.data.isVisible())if(i.which===t.ENTER||i.which===t.SPACE){let n=i.data.allItems.filter(".dropdownlist-list-item-active");n.length>0?n.click():i.data.hide();i.preventDefault()}else if(i.which===t.ARROW_UP||i.which===t.ARROW_DOWN||i.which===t.PAGE_UP||i.which===t.PAGE_DOWN){let u=i.data.allItems.filter(":visible"),f=u.index(i.data.allItems.filter(".dropdownlist-list-item-active")),r=f;if(i.which===t.ARROW_UP&&f>0)r=f-1;else if(i.which===t.ARROW_DOWN&&f<u.length-1)r=f+1;else if(i.which===t.PAGE_UP){let t=i.data.list.height()-n(u[r]).outerHeight(!0);while(t>0&&r>0)r--,t-=n(u[r]).outerHeight(!0)}else if(i.which===t.PAGE_DOWN){let t=i.data.list.height()-n(u[r]).outerHeight(!0);while(t>0&&r<u.length-1)r++,t-=n(u[r]).outerHeight(!0)}r!==f&&(i.data.allItems.removeClass("dropdownlist-list-item-active"),n(u[r]).addClass("dropdownlist-list-item-active"),i.data.scrollToActiveItem());i.preventDefault()}else i.which===t.ESCAPE&&(i.data.hide(),i.data.selector.focus());else(i.which===t.ENTER||i.which===t.SPACE||i.which===t.ARROW_DOWN||i.which===t.PAGE_DOWN)&&(i.data.show(),i.data.isMultiselect&&(i.which===t.ARROW_DOWN||i.which===t.PAGE_DOWN)&&(i.data.allItems.first().addClass("dropdownlist-list-item-active"),i.data.scrollToActiveItem()),i.preventDefault())}},t={ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,ARROW_UP:38,ARROW_DOWN:40}})(jQuery);